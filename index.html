<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=2.0, minimum-scale=0.5, user-scalable=yes">
    <title>Счетчик времени</title>
    <!-- Telegram Web App SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <!-- Иконка для браузера (favicon) -->
    <link rel="icon" type="image/png" href="favicon.png">
    <!-- Иконка для главного экрана iOS -->
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <!-- Иконка для Android (через manifest) -->
    <link rel="manifest" href="manifest.json">
    <!-- Цвет темы для Android -->
    <meta name="theme-color" content="#4CAF50">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
            height: 100vh;
            overflow-x: hidden;
            overflow-y: auto;
        }
        .tracker {
            border: 1px solid var(--tg-theme-hint-color, #ccc);
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 5px;
        }
        .container {
            text-align: center;
            max-width: 100%;
            width: 100%;
            box-sizing: border-box;
        }
        .input-group {
            margin: 10px 0;
        }
        .progress-bar {
            width: 100%;
            background-color: var(--tg-theme-secondary-bg-color, #f0f0f0);
            height: 20px;
            border-radius: 10px;
            margin-top: 10px;
            display: none;
        }
        .progress {
            width: 0%;
            height: 100%;
            background-color: var(--tg-theme-button-color, #4CAF50);
            border-radius: 10px;
            transition: width 0.3s;
        }
        button {
            padding: 5px 10px;
            margin: 5px;
            background-color: var(--tg-theme-button-color, #4CAF50);
            color: var(--tg-theme-button-text-color, #ffffff);
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>Счетчики времени</h2>
        <div id="trackers"></div>
        <button onclick="addTracker()">Добавить отслеживание</button>
    </div>

    <script>
        let trackerCount = 0;

        function addTracker(text = "Событие началось", startDate = "", endDate = "") {
            trackerCount++;
            const trackerDiv = document.createElement('div');
            trackerDiv.className = 'tracker';
            trackerDiv.id = `tracker-${trackerCount}`;
            
            trackerDiv.innerHTML = `
                <div class="input-group">
                    <input type="text" id="text-${trackerCount}" placeholder="Введите свой текст" value="${text}">
                </div>
                <div class="input-group">
                    <label>Дата начала:</label>
                    <input type="date" id="start-${trackerCount}" value="${startDate}" onchange="updateTimer(${trackerCount}); saveTrackers()">
                </div>
                <div class="input-group">
                    <label>Дата окончания (опционально):</label>
                    <input type="date" id="end-${trackerCount}" value="${endDate}" onchange="updateTimer(${trackerCount}); saveTrackers()">
                </div>
                <p id="time-${trackerCount}"></p>
                <div class="progress-bar" id="bar-${trackerCount}">
                    <div class="progress" id="progress-${trackerCount}"></div>
                </div>
                <p id="progress-text-${trackerCount}"></p>
                <button onclick="removeTracker(${trackerCount})">Удалить</button>
            `;
            
            document.getElementById('trackers').appendChild(trackerDiv);
            updateTimer(trackerCount);
            saveTrackers();
        }

        function removeTracker(id) {
            const tracker = document.getElementById(`tracker-${id}`);
            if (tracker) {
                tracker.remove();
                saveTrackers();
            }
        }

        function calculateRemainingTime(remainingTime) {
            const remainingDays = Math.ceil(remainingTime / (1000 * 60 * 60 * 24));
            const years = Math.floor(remainingDays / 365);
            const months = Math.floor((remainingDays % 365) / 30);
            const weeks = Math.floor((remainingDays % 30) / 7);
            const days = remainingDays % 7;

            let result = 'Осталось: ';
            if (years > 0) result += `${years} лет `;
            if (months > 0) result += `${months} месяцев `;
            if (weeks > 0) result += `${weeks} недель `;
            if (days > 0) result += `${days} дней`;
            return result.trim();
        }

        function updateTimer(id) {
            const startDate = new Date(document.getElementById(`start-${id}`).value);
            const endDate = document.getElementById(`end-${id}`).value ? 
                new Date(document.getElementById(`end-${id}`).value) : null;
            const customText = document.getElementById(`text-${id}`).value || 'Событие началось';
            const now = new Date();

            if (!startDate || isNaN(startDate)) {
                document.getElementById(`time-${id}`).textContent = 'Выберите дату начала';
                return;
            }

            const diffTime = Math.abs(now - startDate);
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            const years = Math.floor(diffDays / 365);
            const months = Math.floor((diffDays % 365) / 30);
            const days = diffDays % 30;

            let timeString = `${customText} `;
            if (years > 0) timeString += `${years} лет `;
            if (months > 0) timeString += `${months} месяцев `;
            if (days > 0) timeString += `${days} дней назад`;

            document.getElementById(`time-${id}`).textContent = timeString;

            const progress